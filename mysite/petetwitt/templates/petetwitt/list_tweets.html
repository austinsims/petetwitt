
{% extends "petetwitt/base.html" %}

{% block head %}
{% if enable_autorefresh %}
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script type="text/javascript">
var count;

function update() {
  $.get("{% url 'count' %}",function(data,status){
    if (data > count) {
      location.reload(true)
    }
    count = data
  });
}

$(document).ready(function(){
  $.get("{% url 'count' %}",function(data,status){
    count = data;
  });
  update();
  setInterval(update, 1000);
});
</script>
{% endif %}
{% endblock %}

{% block content %}

<form action="{% url 'post'  %}" method="POST">
  {% csrf_token %}
  <ul>
    {{ form.as_p }}
  </ul>
  <input type="submit" value="Tweet" />
</form>


<hr/>
{% for tweet in tweets %}
	{% include "petetwitt/tweet.html" %}
{% endfor %}
{% endblock %}
